{% extends "base.html" %}

{% block below_tagline %}
<a id="more-link" href="#"
   onclick="toggle('more-link'); toggle('more'); return false;">More...</a>
{% endblock %}


{% block content %}

<div id="more" style="display: none" />
<p>Bridgy sends
<a href="http://webmention.org/">webmentions</a> for comments, likes, and
reshares on Facebook, Twitter, Google+, and Instagram. Bridgy notices when you
post links, watches for activity on those posts, and sends them back to your
site as webmentions. It also serves them as
<a href="http://microformats.org/wiki/microformats2">microformats2</a> for
webmention targets to read.</p>

<p>You can <a href="#users">see who's using Bridgy</a>, click on a button
below to try it yourself, read <a href="/about">even more details</a>, or
<a href="http://indiewebcamp.com/">learn about the Indieweb</a>.</p>
</div>


<!-- Connect buttons -->
<div class="row">
 <p class="big">Step 1: sign up</p>
</div>

<div id="connect" class="row">
<div class="col-md-3 col-sm-6">
 <form method="post" name="facebook-start" action="/facebook/start">
  <input type="image" alt="Sign in with Facebook"
         src="/static/facebook_button_signin.png" />
  <input name="state" type="hidden" value="listen" />
  <!-- https://developers.facebook.com/docs/reference/login/ -->
  <input name="scope" type="hidden"
         value="offline_access,user_website,user_status,user_photos,user_events,read_stream">
</form></div>
<div class="col-md-3 col-sm-6">
 <form method="post" name="twitter-start" action="/twitter/start">
  <input type="image" alt="Sign in with Twitter"
         src="/static/twitter_button_signin.png" />
  <input name="state" type="hidden" value="listen" />
</form></div>
<div class="clearfix visible-xs"></div>
<div class="col-md-3 col-sm-6">
 <form method="post" name="googleplus-start" action="/googleplus/start">
  <input type="image" alt="Sign in with Google+"
         src="/static/googleplus_button_signin.png" />
  <!-- The state param doesn't actually work for G+. Not sure why. Doesn't
       matter for now since we don't support publish for G+. -->
  <input name="state" type="hidden" value="listen" />
  <!-- https://developers.google.com/+/api/oauth#scopes -->
  <input name="scope" type="hidden"
         value="https://www.googleapis.com/auth/plus.login" />
</form></div>
<div class="col-md-3 col-sm-6">
 <form method="post" name="instagram-start" action="/instagram/start">
  <input type="image" alt="Sign in with Instagram"
         src="/static/instagram_button_signin.png" />
  <input name="state" type="hidden" value="listen" />
</form></div>
</div>

<br />

<!-- Users -->
<p id="users" class="big row">Users</p>

{# TODO: paging #}
<div id="sources">
{% for source in sources %}

<div id="{{ source.dom_id }}" class="row">
 <div class="col-sm-4">
  {% with "listen" as feature %}
    {% include "source.html" %}
  {% endwith %}

 </div><div class="col-sm-4">
  {% if source.last_poll_attempt == epoch %}
    Not polled yet
  {% else %}
    Polled
    <a href="/log?start_time={{ source.last_poll_attempt|date:'U' }}&key={{ source.key.urlsafe }}">
      {{ source.last_poll_attempt|timesince }} ago
    {% if source.status == "error" %}
     <span title="Error" class="glyphicon glyphicon-exclamation-sign"></span>
    {% endif %}
    </a>
  {% endif %}

  <!-- <form method="post" action="/poll"> -->
  <!--   <input name="key" type="hidden" value="{{ source.key.urlsafe }}" /> -->
  <!--   <button type="submit" title="Poll now" class="glyphicon glyphicon-refresh" -->
  <!--           style="border: none; background: none;"></button> -->
  <!-- </form> -->

 </div><div class="col-sm-4" id="link-responses-{{ source.dom_id }}">
  <a href="#{{ source.dom_id }}"
     onclick="toggle_ajax('responses', '{{ source.dom_id }}'); return false;">
    Recent responses...
  </a>
 </div>
</div>

<div id="stub-responses-{{ source.dom_id }}" class="stub-responses"
     style="display: none">
  <img src="/static/spinner.gif" width="30" /> <!-- filled in via AJAX -->
</div>

{% endfor %}
</div>

{% endblock %}
