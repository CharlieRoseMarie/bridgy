<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Brid.gy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="mobile-web-app-capable" content="yes"/>
<link rel="shortcut icon" href="/static/favicon.png">
<link rel="apple-touch-icon-precomposed" href="/static/favicon.png"/>

<!-- Bootstrap CSS -->
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" />
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-theme.min.css" />
<!-- Include my stylesheet after so it overrides -->
<link rel="stylesheet" href="/static/style.css" type="text/css" />

<script type="text/javascript">
<!-- google analytics -->
var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-11785301-2']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

function toggle(id) {
  var elem = document.getElementById(id);
  elem.style.display = (elem.style.display == "none") ? "block" : "none";
}

window.onload = function() {
  var id = window.location.hash.substr(1);
  var target = document.getElementById(id);
  if (target) {
    window.setTimeout(function() { target.style.backgroundColor = "white"; },
                      3000 /* ms */);
    toggle("comments-" + id);
  }
}
</script>

</head>

<!-- Content starts here -->
<body>

{# TODO: javascript to set browser location to / so that reloads are harmless #}
<div id="messages">
{% for msg in msgs %}
  <p>{{ msg }}</p>
{% endfor %}
</div>

<main class="tp-main lead container">

<div class="row">
<div id="logo" class="col-sm-4">
 <a href="/">
   <img id="logo-img" class="img-responsive" src="/static/bridgy_logo.jpg" /></a>
</div>

<div id="header" class="col-sm-8">
<p class="big">
Got an <a href="http://indiewebcamp.com/why">Indieweb</a> site?
<br />
<a href="http://indiewebcamp.com/POSSE">POSSE</a> your posts to the silos?
<br />
<span id="title">Brid.gy</span>
<a href="http://indiewebcamp.com/backfeed">backfeeds</a> comments to your site.
<br />
</p>
<a href="#" onclick="toggle('more'); return false;">More...</a>
</div>
</div>

<p class="clearfix" />

<div id="more" style="display: none" />
<p>Brid.gy is a service that sends
<a href="http://webmention.org/">webmentions</a> for comments on Facebook,
Twitter, Google+, and Instagram. Brid.gy polls your posts,
discovers <a href="http://indiewebcamp.com/original-post-discovery">original
post links</a>, and sends comments to those links as webmentions. It also serves
each silo post and comment
as <a href="http://microformats.org/wiki/microformats2">microformats2</a> for
webmention targets to read.</p>

<p>You can <a href="#users">see who's using Brid.gy</a> or click on a button
below to try it yourself.</p>
</div>


<!-- Connect buttons -->
<div id="connect" class="row">
<p class="error row">Bridgy is alpha software. Use with caution!</p>
<div class="col-md-3 col-sm-6"><form method="post" action="/facebook/start">
  <input type="image" alt="Sign in with Facebook" src="/static/facebook_button.png" />
</form></div>
<div class="col-md-3 col-sm-6"><form method="post" action="/twitter/start">
  <input type="image" alt="Sign in with Twitter" src="/static/twitter_button.png" />
</form></div>
<div class="clearfix visible-xs"></div>
<div class="col-md-3 col-sm-6"><form method="post" action="/googleplus/start">
  <input type="image" alt="Sign in with Google+" src="/static/google_plus_button.png" />
</form></div>
<div class="col-md-3 col-sm-6"><form method="post" action="/instagram/start">
  <input type="image" alt="Sign in with Instagram" src="/static/instagram_button.png" />
</form></div>
</div>

<br />

<!-- Users -->
<p id="users" class="big row">Registered accounts:</p>

{# TODO: paging #}
<div id="sources">
{% for source in sources %}

<div id="{{ source.dom_id }}" class="row"
  {% if source.status == "disabled" %}
     title="This source was disconnected on {{ source.DISPLAY_NAME }}'s end.
            To fix this, delete and re-add it."
  {% else %}{% if source.status == "error" %}
     title="Error"
  {% endif %}{% endif %}>
  <a target="_blank" href="{{ source.url }}">
    <img class="profile" src="{{ source.picture }}" width="64px" /></a>
  <a target="_blank" href="{{ source.url }}" class="source">{{ source.name|safe }}</a>

  ({{ source.DISPLAY_NAME }})

  {% if source.status != "enabled" %}
    <span class="glyphicon glyphicon-exclamation-sign"></span>
  {% endif %}
  <a href="#{{ source.dom_id }}" title="Link">#</a>

  <form method="post" action="/delete/start">
    <input name="key" type="hidden" value="{{ source.key }}" />
    <button type="submit" title="Delete" class="glyphicon glyphicon-remove"
            style="border: none; background: none;"></button>
  </form>

  | {% if source.last_polled == epoch %}
    Not polled yet
  {% else %}
    Last polled
    <a href="/log?start_time={{ source.last_polled|date:'U' }}&key={{ source.key }}">
      {{ source.last_polled|timesince }} ago</a>
  {% endif %}

  <!-- <form method="post" action="/poll"> -->
  <!--   <input name="key" type="hidden" value="{{ source.key }}" /> -->
  <!--   <button type="submit" title="Poll now" class="glyphicon glyphicon-refresh" -->
  <!--           style="border: none; background: none;"></button> -->
  <!-- </form> -->

  | {% if source.recent_comments %}
    <a href="#" onclick="toggle('comments-{{ source.dom_id }}'); return false;">
      Recent comments...</a>
  {% else %}
    No comments yet
  {% endif %}
</div>

<ul id="comments-{{ source.dom_id }}"
    class="comments" style="display: none" />
  {% for comment in source.recent_comments %}
  {% with comment.comment as c %}
  <li>
    <a target="_blank" href="{{ c.author.url }}">
      <img class="profile" src="{{ c.author.image.url }}" width="32" />
      <!-- {{ c.author.displayName }}</a>: -->
    <a target="_blank" href="{{ c.url }}">{{ c.content|striptags|truncatewords:6|safe }}</a>
    {% with comment.activity.object as a %}
    on <a target="_blank" href="{{ a.url }}">{{ a.content|striptags|truncatewords:6|safe }}</a>
    {% endwith %}
    |
    <a href="/log?start_time={{ comment.updated|date:'U' }}&key={{ comment.key }}"
    {% if comment.status == 'complete' %}
       title="Completed"><span class="glyphicon glyphicon-ok-sign"></span>
    {% else %}{% if comment.status == 'error' %}
      title="Error"><span class="glyphicon glyphicon-exclamation-sign"></span>
    {% else %}{% if comment.status == 'processing' %}
      title="Processing"><span class="glyphicon glyphicon-transfer"></span>
    {% else %}>
    {% endif %}{% endif %}{% endif %}
      {{ comment.updated|timesince }} ago</a>
  </li>
  {% endwith %}
  {% endfor %}
</ul>

{% endfor %}
</div>

<div id="footer">
  <a href="http://snarfed.org/2012-01-08_bridgy_launched">About</a>
  | <a href="#faq">FAQ</a>
  | <a href="http://snarfed.org/about">Contact</a>
  | <a href="https://github.com/snarfed/bridgy">Source</a>
</div>

</div>
</main>
</body>
</html>

